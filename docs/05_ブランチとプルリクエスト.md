# 05. ブランチとプルリクエスト

> **対象**: チーム開発を始める方  
> **所要時間**: 45分程度

## この章で学ぶこと

- ブランチの概念と使い方
- ブランチでの作業方法
- プルリクエストの作成とマージ
- チーム開発の基本ワークフロー

---

## 1. ブランチとは？

### なぜブランチを使うのか？

**疑問**: 「メインブランチだけで作業すればいいのでは？」

**答え**: ブランチを使うことで以下のメリットがあります：

1. **安全な開発**: メインブランチを壊すことなく新機能を開発できる
2. **並行作業**: 複数人が同時に異なる機能を開発できる
3. **品質管理**: プルリクエストでコードレビューができる
4. **問題の分離**: バグが発生しても他の機能に影響しない

### ブランチのイメージ

```
メインブランチ (main)
├── 機能Aの開発 (feature/login)
├── 機能Bの開発 (feature/payment)
└── バグ修正 (fix/header-bug)
```

**ポイント**: メインブランチは常に安定した状態を保ち、各機能は独立して開発します

---

## 2. ブランチの基本操作

### ブランチの作成と切り替え

```bash
# 新しいブランチを作成して切り替え
git checkout -b feature/login

# または（新しい書き方）
git switch -c feature/login
```

### ブランチ名のルール

- `feature/機能名`: 新機能開発
- `fix/バグ名`: バグ修正
- `hotfix/緊急修正名`: 緊急修正

### ブランチの確認

```bash
# 現在のブランチを確認
git branch

# すべてのブランチ（リモート含む）を確認
git branch -a
```

**期待される結果**:
```
  main
* feature/login
  feature/payment
```

### ブランチの切り替え

```bash
# 別のブランチに切り替え
git checkout main
# または
git switch main
```

---

## 3. ブランチでの作業

### 基本的な作業フロー

```bash
# 1. メインブランチから最新の変更を取得
git checkout main
git pull origin main

# 2. 新しいブランチを作成
git checkout -b feature/my-feature

# 3. 作業を行う（ファイルを編集）

# 4. 変更をコミット
git add .
git commit -m "feat: 新機能を実装"

# 5. ブランチをプッシュ（初回は -u オプションが必要）
git push -u origin feature/my-feature
```

### 新しいブランチの初回プッシュ

```bash
# 新しいブランチを初回プッシュする時は -u オプションが必要
git push -u origin feature/login

# 2回目以降は -u なしでOK
git push
```

**ポイント**: `-u`オプションは上流ブランチを設定するため、初回のみ必要

---

## 4. プルリクエストの作成

### 手順

1. **GitHubのWeb画面で**:
   - 「Compare & pull request」ボタンをクリック
   - タイトルと説明を記入
   - 「Create pull request」をクリック

2. **プルリクエストの内容**:
   - **タイトル**: 変更内容を簡潔に
   - **説明**: 変更の詳細、テスト内容、関連Issueなど

### プルリクエストの例

**タイトル**: `feat: ユーザーログイン機能を追加`

**説明**:
```
## 概要
ユーザーがメールアドレスとパスワードでログインできる機能を追加しました。

## 変更内容
- ログインフォームの作成
- 認証ロジックの実装
- エラーハンドリングの追加

## テスト
- [ ] 正常なログイン
- [ ] 不正な認証情報でのエラー
- [ ] バリデーションエラー

## 関連Issue
Closes #123
```

---

## 5. プルリクエストのレビュー

### レビュー待ち

- チームメンバーがコードを確認
- コメントや修正依頼があれば対応
- 必要に応じて追加のコミット

### 修正の対応

```bash
# 修正をコミット
git add .
git commit -m "fix: レビュー指摘を修正"

# プッシュ
git push
```

---

## 6. プルリクエストのマージ

### マージの実行

1. **GitHubのWeb画面で**:
   - 「Merge pull request」をクリック
   - マージ方法を選択
   - 「Confirm merge」をクリック

### マージ方法の選択

- **Create a merge commit**: マージコミットを作成（推奨）
- **Squash and merge**: コミットをまとめてマージ
- **Rebase and merge**: リベースしてマージ

---

## 7. マージ後のブランチ整理

### 目的

完了したブランチを整理してリポジトリをクリーンに保つ

### 手順

```bash
# メインブランチに切り替え
git checkout main

# 最新の変更を取得（マージされた内容を含む）
git pull origin main

# ローカルの不要なブランチを削除
git branch -d feature/login

# リモートのブランチも削除
git push origin --delete feature/login
```

**ポイント**: ブランチの削除は必須ではありませんが、整理のために行うと良い

---

## 8. チーム開発の典型的なワークフロー

### 1. プロジェクト開始時

```bash
# 1. リポジトリをクローン
git clone https://github.com/team/project.git
cd project

# 2. 自分のブランチを作成
git checkout -b feature/my-feature

# 3. 作業開始
```

### 2. 作業中

```bash
# 1. 変更を確認
git status

# 2. 変更をステージング
git add .

# 3. コミット
git commit -m "feat: 新機能を実装"

# 4. プッシュ（初回は -u オプションが必要）
git push -u origin feature/my-feature

# 5. 2回目以降のプッシュ
git push
```

### 3. チームとの同期

```bash
# 1. メインブランチに切り替え
git checkout main

# 2. 最新の変更を取得
git pull origin main

# 3. 自分のブランチに戻る
git checkout feature/my-feature

# 4. メインの変更をマージ
git merge main
```

---

## 9. トラブルシューティング

### エラー: `fatal: A branch named 'feature/login' already exists`

**原因**: 同じ名前のブランチが既に存在

**対処法**:
```bash
# 既存のブランチを確認
git branch -a

# 別の名前でブランチを作成
git checkout -b feature/login-v2
```

### エラー: `error: The branch 'feature/login' is not fully merged`

**原因**: マージされていないブランチを削除しようとした

**対処法**:
```bash
# 強制削除
git branch -D feature/login

# または、マージしてから削除
git checkout main
git merge feature/login
git branch -d feature/login
```

---

## 10. 次のステップ

ブランチとプルリクエストをマスターしたら、以下を学習してください：

- [06_トラブルシューティング.md](06_トラブルシューティング.md) - エラー対処法
- [07_練習問題.md](07_練習問題.md) - 実践練習

---

## よくある質問

### Q: ブランチ名は日本語でも大丈夫ですか？
A: 英語での命名を推奨します。チーム内で統一したルールを決めましょう。

### Q: プルリクエストは誰がマージすればいいですか？
A: 通常はコードレビューを行った人がマージします。チームのルールに従ってください。

### Q: マージ後にブランチを削除し忘れました
A: 後からでも削除可能です。GitHubのWeb画面からも削除できます。

### Q: プルリクエストを途中でキャンセルできますか？
A: はい、GitHubのWeb画面で「Close pull request」をクリックしてキャンセルできます。
